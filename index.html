<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì±„íŒ… ë³´ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Pretendard', sans-serif;
            background-color: #f3f4f6;
        }

        .loading {
            text-align: center;
            padding: 10px;
            color: gray;
        }

        /* ë²„íŠ¼ ê³ ì • ìœ„ì¹˜ */
        /* ë²„íŠ¼ ì¤‘ì•™ ì •ë ¬ ë° ê³ ì • */
        .macro-buttons {
            position: sticky;
            top: 0;
            left: 0;
            right: 0;
            z-index: 100;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid #ddd;
            max-width: 100%;
            /* ëª¨ë°”ì¼ì—ì„œë„ ê°€ë“ ì°¨ê²Œ */
            width: 100%;
            flex-wrap: wrap;
            /* ë²„íŠ¼ì´ ë§ì•„ì§€ë©´ ì¤„ë°”ê¿ˆ */
        }

        .macro-button {
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease-in-out;
        }

        .macro-button:hover {
            background: rgba(37, 99, 235, 1);
        }

        #chat-container {
            max-height: 750px;
            overflow-y: auto;
            width: 100%;
            scroll-behavior: smooth;
            background-size: contain;
            background-position: center;
            background-repeat: no-repeat;
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            backdrop-filter: blur(3px);
            position: relative;
            max-width: 420px;
        }

        .chat-bubble {
            padding: 12px;
            border-radius: 12px;
            opacity: 0.85;
        }

        .chat-user {
            background-color: rgba(59, 130, 246, 0.75);
            color: white;
        }

        .chat-other {
            background-color: rgba(236, 72, 153, 0.75);
            color: white;
        }

        /* ë©”ì‹œì§€ ì¸ë±ìŠ¤ ìŠ¤íƒ€ì¼ */
        .message-index {
            font-size: 12px;
            color: rgb(0, 0, 0);
            margin-left: 8px;
        }

        @media (max-width: 640px) {
            .macro-buttons {
                max-width: 100%;
                /* ëª¨ë°”ì¼ì—ì„œ ê°€ë¡œí­ ë§ì¶”ê¸° */
                justify-content: center;
            }

            #chat-container {
                max-height: 90vh;
                border-radius: 0;
                box-shadow: none;
            }

            .message {
                max-width: 80%;
            }
        }
    </style>
</head>

<body class="bg-gray-100 flex flex-col items-center min-h-screen px-2">
    <!-- ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´ (ìë™ ì¬ìƒ + ë°˜ë³µ) -->
    <audio id="bg-music" autoplay loop>
        <source src="music/audio.m4a" type="audio/mp3">
        ë¸Œë¼ìš°ì €ê°€ ì˜¤ë””ì˜¤ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    </audio>
    
    <!-- ìŒì•… ì»¨íŠ¸ë¡¤ ë²„íŠ¼ -->
    <div class="fixed bottom-5 right-5 p-3 bg-blue-500 text-white rounded-full cursor-pointer" id="music-toggle">
        ğŸµ ìŒì•… ë„ê¸°
    </div>
    
    <!-- <div class="macro-buttons">
        <button class="macro-button" onclick="scrollToMessage(0)">ì²˜ìŒìœ¼ë¡œ</button>
        <button class="macro-button" onclick="scrollToMessage(10)">10ë²ˆì§¸ ë©”ì‹œì§€</button>
        <button class="macro-button" onclick="scrollToMessage(30)">30ë²ˆì§¸ ë©”ì‹œì§€</button>
        <button class="macro-button" onclick="scrollToMessage(4000)">50ë²ˆì§¸ ë©”ì‹œì§€</button>
        <button class="macro-button" onclick="scrollToMessage(-1)">ë§ˆì§€ë§‰ìœ¼ë¡œ</button>
    </div> -->
    <!-- ì±„íŒ… ë°•ìŠ¤ -->
    <div class="w-full max-w-md bg-white shadow-lg rounded-lg p-4 relative" id="chat-container">
        <div id="background-fade"></div>
        <div id="messages"></div>
        <div class="loading" id="loading">ë¡œë”© ì¤‘...</div>
    </div>

<!-- GSAP ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
   
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const bgMusic = document.getElementById("bg-music");
        const musicToggle = document.getElementById("music-toggle");
        const chatContainer = document.getElementById("chat-container"); // ì±„íŒ…ì°½ ìš”ì†Œ
        let musicPlayed = false; // ìŒì•…ì´ ì‹¤í–‰ë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ë³€ìˆ˜

        async function playMusic() {
            try {
                await bgMusic.play();
                bgMusic.muted = false; // ğŸ”¥ ì†Œë¦¬ ì¼œê¸°
                musicToggle.textContent = "ğŸµ ìŒì•… ë„ê¸°";
                musicPlayed = true; // í•œ ë²ˆ ì‹¤í–‰ë˜ë©´ ë‹¤ì‹œ ì‹¤í–‰ë˜ì§€ ì•Šë„ë¡ ì„¤ì •
                console.log("ğŸµ ìŒì•… ìë™ ì¬ìƒ ì„±ê³µ!");
            } catch (error) {
                console.error("â›” ìŒì•… ìë™ ì¬ìƒ ì°¨ë‹¨ë¨. ë°˜ë“œì‹œ ì‚¬ìš©ì ì¸í„°ë™ì…˜ì´ í•„ìš”í•©ë‹ˆë‹¤.");
            }
        }

        // ğŸ“Œ **ì‚¬ìš©ìì˜ ëª¨ë“  ì¸í„°ë™ì…˜(í´ë¦­, í„°ì¹˜, í‚¤ ì…ë ¥, ìŠ¤í¬ë¡¤)ì„ ê°ì§€í•˜ì—¬ ìë™ ì¬ìƒ**
        function handleUserInteraction() {
            if (!musicPlayed) {
                playMusic();
                removeInteractionListeners(); // ğŸ¯ í•œ ë²ˆ ì‹¤í–‰ë˜ë©´ ì´ë²¤íŠ¸ ì œê±°
            }
        }

        function removeInteractionListeners() {
            chatContainer.removeEventListener("scroll", handleUserInteraction);
            document.removeEventListener("click", handleUserInteraction);
            document.removeEventListener("keydown", handleUserInteraction);
            document.removeEventListener("touchstart", handleUserInteraction);
        }

        // ğŸ“Œ **ìŠ¤í¬ë¡¤, í´ë¦­, í‚¤ ì…ë ¥, í„°ì¹˜ ì¤‘ í•˜ë‚˜ë¼ë„ ê°ì§€ë˜ë©´ ìë™ ì¬ìƒ**
        chatContainer.addEventListener("scroll", () => {
            if (chatContainer.scrollTop > 50) { // ë„ˆë¬´ ë¯¼ê°í•˜ì§€ ì•Šê²Œ ì„¤ì •
                handleUserInteraction();
            }
        });

        document.addEventListener("click", handleUserInteraction);
        document.addEventListener("keydown", handleUserInteraction);
        document.addEventListener("touchstart", handleUserInteraction);

        // ğŸµ ìŒì•… ON/OFF ë²„íŠ¼ ê¸°ëŠ¥
        musicToggle.addEventListener("click", function () {
            if (bgMusic.paused) {
                playMusic();
            } else {
                bgMusic.pause();
                musicToggle.textContent = "ğŸ”‡ ìŒì•… ì¼œê¸°";
            }
        });
    });
</script>
<script>
        const chatContainer = document.getElementById("chat-container");
        const messageContainer = document.getElementById("messages");
        const loadingIndicator = document.getElementById("loading");
        const backgroundFade = document.getElementById("background-fade");

        let chatData = [];
        let currentIndex = 0;
        const batchSize = 20;
        let messageElements = []; // ì±„íŒ… ë©”ì‹œì§€ ì €ì¥


        
    // ì‚¬ìš©í•  ë°°ê²½ ì´ë¯¸ì§€ ë¦¬ìŠ¤íŠ¸ (image/1.jpg ~ image/30.jpg)
    const backgroundImages = Array.from({ length: 30 }, (_, i) => `image/${i + 1}.jpg`);
    let currentImageIndex = 0;

    // ì´ˆê¸°ì— 1ë²ˆ ì´ë¯¸ì§€ ì„¸íŒ…
    function setDefaultBackground() {
        chatContainer.style.backgroundImage = `url('${backgroundImages[0]}')`; // ê¸°ë³¸ ë°°ê²½ 1.jpg
        backgroundFade.style.backgroundImage = `url('${backgroundImages[0]}')`; // ì´ˆê¸° ë°°ê²½ë„ ë™ì¼í•˜ê²Œ ì„¤ì •
        console.log("ì´ˆê¸° ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì •:", backgroundImages[0]); // ë””ë²„ê·¸ ë¡œê·¸
    }

    // ì¼ì •í•œ ì‹œê°„ ê°„ê²©ìœ¼ë¡œ ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ (GSAP ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
    function changeBackgroundImage() {
        currentImageIndex = (currentImageIndex + 1) % backgroundImages.length;
        const newImage = backgroundImages[currentImageIndex];

        console.log("ë³€ê²½í•  ë°°ê²½ ì´ë¯¸ì§€:", newImage); // ì ìš© ì—¬ë¶€ í™•ì¸ ë¡œê·¸

        if (!backgroundFade) {
            console.error("âš ï¸ `backgroundFade` ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. HTML êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.");
            return;
        }

        // 1. ìƒˆë¡œìš´ ì´ë¯¸ì§€ ì„¤ì • (fade-in ì ìš©í•  backgroundFadeì— ë¨¼ì € ì ìš©)
        backgroundFade.style.backgroundImage = `url('${newImage}')`;
        backgroundFade.style.zIndex = 2; // fade-inì„ ìœ„ì— ìœ„ì¹˜ì‹œì¼œ ì „í™˜ íš¨ê³¼ ì ìš©

        // 2. GSAP ì• ë‹ˆë©”ì´ì…˜ ì ìš© (ë¶€ë“œëŸ¬ìš´ ë°°ê²½ ë³€ê²½)
        gsap.fromTo(backgroundFade, 
            { opacity: 0 }, // ê¸°ì¡´ì—ëŠ” íˆ¬ëª…
            { opacity: 1, duration: 1.5, ease: "power2.out", onComplete: () => {
                // 3. chatContainerì— ìƒˆë¡œìš´ ë°°ê²½ ì„¤ì •
                chatContainer.style.backgroundImage = `url('${newImage}')`;
                backgroundFade.style.zIndex = 1; // ë‹¤ì‹œ ë‚®ì¶°ì„œ ìƒˆë¡œìš´ ë°°ê²½ ì ìš©

                console.log("ë°°ê²½ ì´ë¯¸ì§€ ì ìš© ì™„ë£Œ:", newImage); // í™•ì¸ ë¡œê·¸

                // 4. ë‹¤ì‹œ fade-out ì²˜ë¦¬
                gsap.to(backgroundFade, { opacity: 0, duration: 1.5, ease: "power2.in" });
            }
        });
    }

    // í˜ì´ì§€ê°€ ë¡œë“œë  ë•Œ 1ë²ˆ ì´ë¯¸ì§€ë¥¼ ê¸°ë³¸ ë°°ê²½ìœ¼ë¡œ ì„¤ì •
    setDefaultBackground();

    // ì¼ì • ê°„ê²©(5ì´ˆ)ë§ˆë‹¤ ë°°ê²½ ë³€ê²½ (GSAP ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
    setTimeout(() => {
        setInterval(changeBackgroundImage, 5000);
    }, 5000); // 5ì´ˆ ë’¤ë¶€í„° ë°°ê²½ ë³€ê²½ ì‹œì‘

        // ì±„íŒ… ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
        // ì±„íŒ… ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” í•¨ìˆ˜
        function scrollToMessage(targetIndex) {
            if (targetIndex === -1) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
                return;
            }

            function checkAndScroll() {
                // ë©”ì‹œì§€ ìš”ì†Œ ì¤‘ì—ì„œ ì •í™•í•œ indexë¥¼ ê°€ì§„ ìš”ì†Œë¥¼ ì°¾ìŒ
                const targetMessage = document.querySelector(`.message-index[data-index="${targetIndex}"]`);

                if (targetMessage) {
                    // í•´ë‹¹ ë©”ì‹œì§€ê°€ ì¡´ì¬í•˜ë©´ ìŠ¤í¬ë¡¤ ì´ë™
                    targetMessage.closest(".message-item").scrollIntoView({ behavior: "smooth", block: "start" });
                } else {
                    // ë©”ì‹œì§€ê°€ ì•„ì§ ë¡œë“œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ìŠ¤í¬ë¡¤ì„ ë‚´ë ¤ì„œ ê³„ì† ë¶ˆëŸ¬ì˜´
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    setTimeout(checkAndScroll, 10); // 0.5ì´ˆ í›„ ë‹¤ì‹œ í™•ì¸
                }
            }

            checkAndScroll();
        }

        // ë¡œì»¬ íŒŒì¼ì—ì„œ ì±„íŒ… ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadChatData() {
            try {
                const response = await fetch("text.txt"); // ë¡œì»¬ íŒŒì¼ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const text = await response.text();
                chatData = text.trim().split("\n");
                renderNextBatch();
            } catch (error) {
                console.error("ì±„íŒ… ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
            }
        }

        // ì±„íŒ… ë°ì´í„° ì¼ë¶€ì”© ë Œë”ë§
        // ì±„íŒ… ë°ì´í„° ì¼ë¶€ì”© ë Œë”ë§
        function renderNextBatch() {
            const messagePattern = /\[(.*?)\] \[(.*?)\] (.*)/;
            const datePattern = /-+ (.*?) -+/;

            for (let i = 0; i < batchSize; i++) {
                if (currentIndex >= chatData.length) {
                    loadingIndicator.style.display = "none";
                    return;
                }

                const line = chatData[currentIndex++];
                if (datePattern.test(line)) {
                    const dateMatch = line.match(datePattern);
                    if (dateMatch) {
                        const dateElement = document.createElement("div");
                        dateElement.className = "text-center text-gray-500 text-sm font-bold my-6";
                        dateElement.textContent = dateMatch[1];
                        messageContainer.appendChild(dateElement);
                    }
                } else {
                    const match = line.match(messagePattern);
                    if (!match) continue;

                    const [, sender, time, text] = match;
                    const isUser = sender === "ìµœë‹¤í›ˆ";

                    const messageElement = document.createElement("div");
                    messageElement.className = `message-item flex ${isUser ? 'justify-start' : 'justify-end'} mb-4`;
                    messageElement.innerHTML = `
                <div class="max-w-xs p-3 rounded-lg chat-bubble ${isUser ? 'chat-user' : 'chat-other'} shadow-md">
                    <p class="text-xs font-bold">${sender} â€¢ ${time} <span class="message-index" data-index="${currentIndex}">#${currentIndex}</span></p>
                    <p class="mt-1">${text}</p>
                </div>
            `;
                    messageContainer.appendChild(messageElement);
                    messageElements.push(messageElement); // ë©”ì‹œì§€ ë°°ì—´ì— ì¶”ê°€
                }
            }
        }

        // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ê°ì§€ -> ë°°ê²½ ë³€ê²½
        chatContainer.addEventListener("scroll", () => {
            if (chatContainer.scrollTop + chatContainer.clientHeight >= chatContainer.scrollHeight - 50) {
                renderNextBatch();
                changeBackgroundImage(); // ì±„íŒ… ë°•ìŠ¤ ë°°ê²½ ì´ë¯¸ì§€ ë³€ê²½ (ë¶€ë“œëŸ¬ìš´ íš¨ê³¼)
            }
        });

        // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
        loadChatData();
    </script>

</body>

</html>